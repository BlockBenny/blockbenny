import React, { useEffect, useState } from "react";
import Head from "next/head";
import { CiTwitter, CiLinkedin } from "react-icons/ci";
import { AiFillGithub } from "react-icons/ai";
import Image from "next/image";
import logo from "../public/BB.png";
import Home from "./home";
import Resume from "./resume";
import About from "./about";
import dynamic from "next/dynamic";
import { AiOutlineDownCircle } from "react-icons/ai";
import AppContext from "../helper";
import deDE from "../locales/de-DE.json";
import enUS from "../locales/en-US.json";
import enFlag from "../public/united-kingdom.png";
import deFlag from "../public/german.png";

export default function Index() {
  const TechStack = dynamic(() => import("./techstack"), { ssr: false });
  const { language, setLanguage } = React.useContext(AppContext);
  const nextNav = React.useRef("techstack");

  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  const toggleMobileMenu = () => {
    setMobileMenuOpen(!mobileMenuOpen);
  };

  useEffect(() => {
    const onScroll = () => SetNextSection(window.pageYOffset);
    window.addEventListener("scroll", onScroll, { passive: true });
    setflagSrc(deFlag);
  }, []);

  var lastY = 0;
  const SetNextSection = (px) => {
    let _1vh = Math.round(window.innerHeight);
    let _1vh7 = (_1vh / 9) * 7;
    let _2vh7 = _1vh7 * 2;
    let _3vh7 = _1vh7 * 3;

    if (lastY > _1vh7 && px < _1vh7) {
      switchSection("navHome");
      changeNavigator("techstack", language.nav.techStack, false);
    }
    if ((lastY < _1vh7 && px > _1vh7) || (lastY > _2vh7 && px < _2vh7)) {
      switchSection("navTech");
      changeNavigator("resume", language.nav.resume, false);
    }
    if ((lastY < _2vh7 && px > _2vh7) || (lastY > _3vh7 && px < _3vh7)) {
      switchSection("navResume");
      changeNavigator("about", language.nav.about, false);
    }
    if (lastY < _3vh7 && px > _3vh7) {
      switchSection("navAbout");
      changeNavigator("", "", true);
    }
    lastY = px;
  };

  const switchSection = (current) => {
    clearNav();
    var ref = document.getElementById(current);
    ref.classList.add("text-textPink", "font-playB");
  };

  const changeNavigator = (next, title, hidden) => {
    var ref = document.getElementById("navigator");
    if (hidden) {
      ref.classList.add("hidden");
    } else {
      ref.classList.remove("hidden");
      nextNav.current = next;
      var refTitle = document.getElementById("navigatorTitle");
      refTitle.innerHTML = title;
    }
  };

  const clearNav = () => {
    var ref = document.getElementById("navHome");
    ref.classList.remove("text-textPink", "font-playB");
    var ref = document.getElementById("navTech");
    ref.classList.remove("text-textPink", "font-playB");
    var ref = document.getElementById("navResume");
    ref.classList.remove("text-textPink", "font-playB");
    var ref = document.getElementById("navAbout");
    ref.classList.remove("text-textPink", "font-playB");
  };

  const scrollIntoSection = (sectionId) => {
    var el = document.getElementById(sectionId);
    window.scroll({ top: el.offsetTop, behavior: "smooth" });
  };

  const [flagSrc, setflagSrc] = useState(deFlag);

  const switchLanguage = () => {
    if (language == enUS) {
      setLanguage(deDE);
      setflagSrc(enFlag);
    } else {
      setLanguage(enUS);
      setflagSrc(deFlag);
    }
  };

  return (
    <>
      <div>
        <Head>
          <title>{language.nav.title}</title>
          <meta name="description" content="Generated by create next app" />
          {/* <link rel="icon" href="/favicon.ico" /> */}
        </Head>
        <main className="font-play min-h-screen bg-gradient-to-br from-bgTL via-bgVIA to-bgTL">
          <nav sticky="top" className="z-50 sm:px-24 md:px-48  fixed min-w-full top-0 py-10 flex justify-between lg:pr-48">
            <div className="z-80 relative h-11 flex">
              <div className="hidden lg:flex w-24">
                <Image alt="Logo" className="ml-32" src={logo} />
              </div>
              <a
                onClick={() => {
                  scrollIntoSection("home");
                }}
                className="text-white px-4 py-2 ml-8 text-xl"
              >
                <h1 className="cursor-pointer  self-center text-3xl text-white font-playB">{language.nav.title}</h1>
              </a>
            </div>
            <div className={`${mobileMenuOpen ? "" : "items-center"} flex sm:w-2/5 lg:w-1/5 fullHd:w-full place-content-end mr-6`}>
              <div className={`${mobileMenuOpen ? "block" : "hidden"} fullHd:hidden w-3/4 float-left bg-bgTo bg-opacity-40 rounded-2xl`}>
                <div className="px-2 py-2">
                  <a
                    onClick={() => {
                      scrollIntoSection("home");
                    }}
                    className="block px-2 py-1 font-semibold text-white hover:bg-gray-800"
                  >
                    {language.nav.home}
                  </a>
                  <a
                    onClick={() => {
                      scrollIntoSection("techstack");
                    }}
                    className="block px-2 py-1 font-semibold text-white hover:bg-gray-800"
                  >
                    {language.nav.techStack}
                  </a>
                  <a
                    onClick={() => {
                      scrollIntoSection("resume");
                    }}
                    className="block px-2 py-1 font-semibold text-white hover:bg-gray-800"
                  >
                    {language.nav.resume}
                  </a>
                  <a
                    onClick={() => {
                      scrollIntoSection("about");
                    }}
                    className="block px-2 py-1 font-semibold text-white hover:bg-gray-800"
                  >
                    {language.nav.about}
                  </a>
                </div>
                <div className="px-2 py-2">
                  <a className="flex items-center hover:text-textPink" onClick={() => window.open("https://twitter.com/Wen_Alpha", "_blank")}>
                    <CiTwitter className="h-6 w-6 mr-2" />
                    <span className="text-xs font-semibold">Twitter</span>
                  </a>
                  <a className="flex items-center hover:text-textPink" onClick={() => window.open("https://www.linkedin.com/in/bennyblock/", "_blank")}>
                    <CiLinkedin className="h-6 w-6 mr-2" />
                    <span className="text-xs font-semibold">LinkedIn</span>
                  </a>
                  <a className="flex items-center hover:text-textPink" onClick={() => window.open("https://github.com/BlockBenny", "_blank")}>
                    <AiFillGithub className="h-6 w-6 mr-2" />
                    <span className="text-xs font-semibold">GitHub</span>
                  </a>
                </div>
                <div className="h-10 w-10 ml-8">
                  <Image src={flagSrc} alt="Language switch Flag" id="languageFlag" onClick={switchLanguage} className="cursor-pointer" />
                </div>
              </div>
              <div className="block fullHd:hidden">
                <button className="flex px-3 py-2 border rounded text-textPink font-playB" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                  <svg className="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    {mobileMenuOpen ? (
                      <path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z" />
                    ) : (
                      <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" />
                    )}
                  </svg>
                </button>
              </div>
              <ul className="hidden fullHd:flex items-center 4k:pr-10">
                <li>
                  <a
                    id="navHome"
                    onClick={() => {
                      scrollIntoSection("home");
                    }}
                    className="cursor-pointer text-textPink font-playB px-4 py-2 ml-8 text-xl"
                  >
                    {language.nav.home}
                  </a>
                </li>
                <li>
                  <a
                    id="navTech"
                    onClick={() => {
                      scrollIntoSection("techstack");
                    }}
                    className="cursor-pointer px-4 py-2 ml-8 text-xl"
                  >
                    {language.nav.techStack}
                  </a>
                </li>
                <li>
                  <a
                    id="navResume"
                    onClick={() => {
                      scrollIntoSection("resume");
                    }}
                    className=" cursor-pointer px-4 py-2 ml-8 text-xl"
                  >
                    {language.nav.resume}
                  </a>
                </li>
                <li>
                  <a
                    id="navAbout"
                    onClick={() => {
                      scrollIntoSection("about");
                    }}
                    className="cursor-pointer  px-4 py-2 ml-8 text-xl"
                  >
                    {language.nav.about}
                  </a>
                </li>
                <li>
                  <CiTwitter onClick={() => window.open("https://twitter.com/Wen_Alpha", "_blank")} className="cursor-pointer h-10 w-10 ml-8" />
                </li>
                <li>
                  <CiLinkedin onClick={() => window.open("https://www.linkedin.com/in/bennyblock/", "_blank")} className="cursor-pointer h-10 w-10 ml-8" />
                </li>
                <li>
                  <AiFillGithub onClick={() => window.open("https://github.com/BlockBenny", "_blank")} className="cursor-pointer h-10 w-10 ml-8" />
                </li>
                <li className="h-10 w-10 ml-10">
                  <Image src={flagSrc} alt="Language switch Flag" id="languageFlag" onClick={switchLanguage} className="cursor-pointer" />
                </li>
              </ul>
            </div>
          </nav>
          <Home />
          <TechStack />
          <Resume />
          <About />
          <div id="navigator" className="w-full b-5 flex justify-center fixed bottom-0 z-50">
            <div id="navigatorTitle" className="z-20 absolute bottom-24 text-xl">
              Tech Stack
            </div>
            <AiOutlineDownCircle id="navigatorCircle" onClick={() => scrollIntoSection(nextNav.current)} className="z-20 cursor-pointer absolute bottom-12 h-10 w-10" />
          </div>
          <div className="hidden lg:flex area">
            <ul className="circles">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </main>
      </div>
    </>
  );
}
